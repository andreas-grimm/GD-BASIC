10 REM INSERTION SORT USING SINGLY-LINKED LIST
20 RANDOMIZE
30 LET L1=1000
40 DIM A(999,2),B(999)
50 GOSUB 370
60 REM INSERT SOME RANDOM ELEMENTS
70 LET N1=1000
80 LET H1=-1
90 FOR I=0 TO N1-1 STEP 1
100 LET T=INT(1000*RND)
110 LET B(I)=T
120 GOSUB 480
129 REM UNCOMMENT NEXT TWO LINES FOR HEAP DUMP AFTER EACH INSERT
130 REM GOSUB 1370
140 REM INPUT A$
150 NEXT I
160 PRINT "SHOW LIST"
180 GOSUB 780
184 REM COMMENT OUT THE STOP ON THE NEXT LINE FOR MORE THOROUGH TESTING
185 STOP
190 REM TEST SEARCHING FOR EXISTING
200 FOR I=0 TO N1-1 STEP 1
210 LET T=B(I)
220 GOSUB 990
230 IF F2=-1 THEN 260
240 PRINT T;"FOUND IN SLOT";F2;"-->";A(F2,0)
250 GOTO 270
260 PRINT T;"UNEXPECTEDLY NOT FOUND!"
270 NEXT I
280 REM DELETE THE REST
290 IF H1=-1 THEN 350
300 LET T=A(H1,0)
305 REM PRINT "REMOVE";T
310 GOSUB 1080
320 GOSUB 880
330 GOTO 290
340 REM PRINT "LAST LIST SHOULD HAVE BEEN EMPTY"
350 GOSUB 1370
360 STOP
370 REM *** INITIALIZE HEAP OF L1 ELEMENTS IN A() ***
380 REM NIL IS -1, FREE LIST POINTER IS F1
390 FOR I=0 TO L1-2
400 LET A(I,1)=I+1
410 LET A(I,0)=0
420 NEXT I
430 LET A(L1-1,1)=-1
440 LET A(L1-1,0)=0
450 LET F1=0
460 LET T1=-1
470 RETURN
480 REM *** INSERT AN ELEMENT T INTO LIST WITH HEAD H1, TAIL T1 ***
490 REM *** F1 IS HEAD OF FREE LIST ***
500 IF F1<>-1 THEN 530
510 PRINT "HEAP EXHAUSTED"
520 STOP
530 LET T2=F1
540 LET F1=A(F1,1)
550 LET A(T2,0)=T
560 IF H1<>-1 THEN 610
570 LET A(T2,1)=-1
580 LET H1=T2
590 LET T1=T2
600 RETURN
610 IF T>=A(H1,0) THEN 650
620 LET A(T2,1)=H1
630 LET H1=T2
640 RETURN
650 LET P1=H1
660 LET C1=A(P1,1)
670 IF C1<>-1 THEN 720
680 LET A(T2,1)=-1
690 LET A(T1,1)=T2
700 LET T1=T2
710 RETURN
720 IF T<A(C1,0) THEN 750
730 LET P1=C1
740 GOTO 660
750 LET A(T2,1)=C1
760 LET A(P1,1)=T2
770 RETURN
780 REM *** SHOW LIST AND INSURE IT IS IN ORDER ***
790 IF H1=-1 THEN 860
795 LET P1=H1
800 PRINT A(P1,0),
810 LET C1=A(P1,1)
820 IF C1=-1 THEN 860
830 IF A(P1,0)>A(C1,0) THEN 840
832 LET P1=C1
834 GOTO 800
840 PRINT "SORT ERROR"
850 STOP
860 PRINT
870 RETURN
880 REM *** DUMP LIST WITH HEAD H1 ***
900 IF H1=-1 THEN 970
910 LET T2=H1
920 PRINT A(T2,0),
930 LET T2=A(T2,1)
940 IF T2=-1 THEN 970
960 GOTO 920
970 PRINT
980 RETURN
990 REM *** SEQUENTIAL SEARCH LIST WITH HEAD H1 FOR T ***
1000 REM F2=-1 NOT FOUND, F2=INDEX IF FOUND
1010 LET F2=-1
1020 LET F2=H1
1030 IF F2=-1 THEN 1070
1040 IF A(F2,0)=T THEN 1070
1050 LET F2=A(F2,1)
1060 GOTO 1030
1070 RETURN
1080 REM *** DELETE T FROM LIST WITH HEAD H1 ***
1090 REM RETURN F2=-1 FOR FAIL, F2=1 FOR SUCCESS
1100 LET F2=-1
1110 REM IS IT EMPTY LIST?
1120 IF H1=-1 THEN 1360
1130 REM IS IT HEAD?
1140 IF A(H1,0)<>T THEN 1220
1150 LET T2=A(H1,1)
1160 LET A(H1,1)=F1
1170 LET F1=H1
1180 LET H1=T2
1190 IF T1<>F1 THEN 1210
1200 LET T1=-1
1210 GOTO 1350
1220 LET T2=H1
1230 LET T3=A(H1,1)
1240 IF T3=-1 THEN 1360
1250 IF A(T3,0)=T THEN 1290
1260 LET T2=T3
1270 LET T3=A(T3,1)
1280 GOTO 1240
1290 REM FOUND IT AND IT IS NOT HEAD
1300 LET A(T2,1)=A(T3,1)
1310 IF A(T2,1)<>-1 THEN 1330
1320 LET T1=T2
1330 LET A(T3,1)=F1
1340 LET F1=T3
1350 LET F2=1
1360 RETURN
1370 REM *** DUMP HEAP ***
1380 PRINT "F1=";F1,"H1=";H1,"T1=";T1
1390 FOR Z=0 TO L1-1
1400 PRINT "A(";Z;",0)=";A(Z,0),"A(";Z;",1)=";A(Z,1)
1410 NEXT Z
1420 RETURN
1430 END
